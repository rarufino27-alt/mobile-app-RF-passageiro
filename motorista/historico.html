<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Histórico - RF Motorista</title>

<link rel="stylesheet" href="../core/ui/layout.css">

<script src="../core/config.js"></script>
<script src="../core/datamanager.js"></script>
<script src="../core/ui/theme.js" defer></script>
<script src="../core/ui/sidebar.js" defer></script>

<style>
.history-day{
  margin:20px;
  font-weight:700;
  font-size:18px;
}

.history-card{
  margin:15px 20px;
  padding:18px;
  border-radius:20px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(8px);
}

.history-top{
  display:flex;
  justify-content:space-between;
  font-weight:800;
  font-size:18px;
}

.history-info{
  margin-top:10px;
  font-size:14px;
  opacity:.8;
}

.history-taxa{
  margin-top:10px;
  font-size:14px;
  color:#ef4444;
}
</style>

</head>
<body>

<aside id="sidebar" class="sidebar"></aside>
<div id="overlay" class="overlay"></div>

<header class="rf-top">
  <div class="menu-btn" onclick="toggleSidebar()">☰</div>
  <div>Histórico</div>
  <div class="credit-box">
    Créditos: <span id="creditosTopo">0.00</span>
  </div>
</header>

<main class="rf-body" id="historicoContainer">
</main>

<script>

document.addEventListener("DOMContentLoaded", ()=>{

  document.getElementById("creditosTopo").innerText =
    DataManager.getCreditos().toFixed(2);

  renderHistorico();
});

function renderHistorico(){

  const container = document.getElementById("historicoContainer");
  const historico = JSON.parse(
    localStorage.getItem(CONFIG.STORAGE_KEYS.HISTORICO)
  ) || [];

  if(historico.length === 0){
    container.innerHTML = `
      <div class="rf-card" style="text-align:center;">
        <h3>Nenhuma corrida realizada ainda</h3>
      </div>
    `;
    return;
  }

  // Ordena do mais recente
  historico.sort((a,b)=> new Date(b.data) - new Date(a.data));

  let html = "";
  let dataAtual = "";

  historico.forEach(corrida => {

    const dataObj = new Date(corrida.data);
    const dia = dataObj.toLocaleDateString("pt-BR");

    if(dia !== dataAtual){
      dataAtual = dia;
      html += `<div class="history-day">${dia}</div>`;
    }

    html += `
      <div class="history-card">
        <div class="history-top">
          <span>R$ ${corrida.valor.toFixed(2)}</span>
          <span>${dataObj.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}</span>
        </div>

        <div class="history-info">
          <strong>Origem:</strong> ${corrida.origem}<br>
          <strong>Destino:</strong> ${corrida.destino}
        </div>

        <div class="history-taxa">
          Taxa plataforma: -R$ ${corrida.taxa.toFixed(2)}
        </div>
      </div>
    `;
  });

  container.innerHTML = html;
}

</script>

</body>
</html>