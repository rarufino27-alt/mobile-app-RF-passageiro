<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finalização</title>

<link rel="stylesheet" href="../core/ui/layout.css">

<script src="../core/config.js"></script>
<script src="../core/datamanager.js"></script>
<script src="../core/services/soundService.js"></script>
<script src="../core/ui/theme.js" defer></script>
<script src="../core/ui/sidebar.js" defer></script>

<style>
.avaliacao{
  margin-top:20px;
  font-size:28px;
}

.estrela{
  cursor:pointer;
  opacity:0.4;
  transition:0.2s;
}

.estrela.ativa{
  opacity:1;
  transform:scale(1.2);
}

.anim-check{
  font-size:60px;
  animation:pop 0.5s ease;
}

@keyframes pop{
  0%{transform:scale(0.5);opacity:0;}
  100%{transform:scale(1);opacity:1;}
}
</style>

</head>

<body>

<aside id="sidebar" class="sidebar"></aside>
<div id="overlay" class="overlay"></div>

<header class="rf-top">
  <div class="menu-btn" onclick="toggleSidebar()">☰</div>
  <div>Finalização</div>
  <div class="credit-box">
    Créditos: <span id="creditosTopo">0.00</span>
  </div>
</header>

<main class="rf-body">

  <div class="rf-card" style="text-align:center;">

    <div class="anim-check">✅</div>

    <h2>Corrida Finalizada</h2>

    <h1>R$ <span id="valorFinal">0.00</span></h1>

    <p>Taxa plataforma 15%</p>
    <p>Desconto: R$ <span id="taxa">0.00</span></p>

    <div class="avaliacao">
      <div>Avalie o passageiro</div>
      <div>
        <span class="estrela" onclick="avaliar(1)">⭐</span>
        <span class="estrela" onclick="avaliar(2)">⭐</span>
        <span class="estrela" onclick="avaliar(3)">⭐</span>
        <span class="estrela" onclick="avaliar(4)">⭐</span>
        <span class="estrela" onclick="avaliar(5)">⭐</span>
      </div>
    </div>

  </div>

  <button class="fab fab-online" onclick="confirmar()">
    OK
  </button>

</main>

<script>

let notaSelecionada = 0;

document.addEventListener("DOMContentLoaded", ()=>{

  document.getElementById("creditosTopo").innerText =
    DataManager.getCreditos().toFixed(2);

  /* Recupera último valor salvo temporariamente */
  const ultimoValor = localStorage.getItem("rf_ultimo_valor");
  const ultimaTaxa = localStorage.getItem("rf_ultima_taxa");

  if(ultimoValor && ultimaTaxa){
    document.getElementById("valorFinal").innerText =
      parseFloat(ultimoValor).toFixed(2);

    document.getElementById("taxa").innerText =
      parseFloat(ultimaTaxa).toFixed(2);
  }

  SoundService.play("MSG_APP");

});

/* =========================
   AVALIAÇÃO
========================= */

function avaliar(nota){

  notaSelecionada = nota;

  const estrelas = document.querySelectorAll(".estrela");

  estrelas.forEach((el, index)=>{
    if(index < nota){
      el.classList.add("ativa");
    }else{
      el.classList.remove("ativa");
    }
  });

}

/* =========================
   CONFIRMAR E VOLTAR
========================= */

function confirmar(){

  if(notaSelecionada === 0){
    alert("Selecione uma avaliação antes de continuar.");
    return;
  }

  window.location.href = "driver-home.html";
}

</script>

</body>
</html>