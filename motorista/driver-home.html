<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RF Motorista</title>

<link rel="stylesheet" href="../core/ui/layout.css">

<script src="../core/config.js"></script>
<script src="../core/datamanager.js"></script>
<script src="../core/services/soundService.js"></script>
<script src="../core/ui/theme.js" defer></script>
<script src="../core/ui/sidebar.js" defer></script>

<style>

/* ===== TOPO GANHOS ===== */

.ganhos-box{
  text-align:center;
  margin-top:20px;
}

.ganhos-valor{
  font-size:32px;
  font-weight:700;
  transition:.3s;
}

.ganhos-valor.masked{
  letter-spacing:6px;
}

.eye-btn{
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  margin-left:8px;
}

/* ===== LISTA DE VIAGENS ===== */

.lista-viagens{
  margin-top:20px;
  max-height:55vh;
  overflow-y:auto;
  padding-bottom:120px;
}

.viagem-item{
  background:#111;
  margin:10px 15px;
  padding:15px;
  border-radius:12px;
  cursor:pointer;
  transition:.2s;
}

.viagem-item:hover{
  transform:scale(1.02);
}

.distancia{
  font-size:13px;
  opacity:.7;
}

/* ===== BARRA INFERIOR ===== */

.bottom-bar{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#000;
  color:#fff;
  padding:15px;
  border-top-left-radius:20px;
  border-top-right-radius:20px;
  transition:.4s;
}

.bottom-bar.collapsed{
  height:60px;
  overflow:hidden;
}

.status-msg{
  text-align:center;
  animation:fadeMsg 3s infinite;
}

@keyframes fadeMsg{
  0%{opacity:1}
  50%{opacity:.3}
  100%{opacity:1}
}

.btn-offline{
  margin-top:10px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:25px;
  background:#ef4444;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  transition:.3s;
}

.btn-offline:hover{
  transform:scale(1.05);
}

/* ===== CARD DETALHE ===== */

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-content{
  background:#111;
  padding:20px;
  border-radius:15px;
  width:90%;
}

.percentuais{
  display:flex;
  gap:8px;
  margin-top:15px;
}

.percentuais button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:20px;
  background:#22c55e;
  color:#000;
  font-weight:600;
  cursor:pointer;
}

.manual{
  margin-top:15px;
}

.manual input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}

.manual button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:20px;
  background:#facc15;
  font-weight:700;
}

</style>
</head>

<body>

<header class="rf-top">
  <div class="menu-btn" onclick="toggleSidebar()">‚ò∞</div>
  <div>RF Motorista</div>
  <div>Cr√©ditos: <span id="creditosTopo">0.00</span></div>
</header>

<main>

<div class="ganhos-box">
  <div>
    Ganhos Hoje
    <button class="eye-btn" onclick="toggleGanhos()">üëÅ</button>
  </div>
  <div id="ganhosValor" class="ganhos-valor">
    R$ <span id="ganhosHoje">0.00</span>
  </div>
</div>

<div class="lista-viagens" id="listaViagens"></div>

</main>

<div class="bottom-bar collapsed" id="bottomBar">
  <div class="status-msg" id="statusMsg">
    Procurando viagem...
  </div>
  <button class="btn-offline" onclick="ficarOffline()">OFFLINE</button>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>

/* ===== DADOS MOCK ===== */

let viagens = [
  {id:1, origem:"Centro", destino:"Shopping", valor:40, distancia:1.2},
  {id:2, origem:"Praia", destino:"Hospital", valor:35, distancia:3.8},
  {id:3, origem:"Rodovi√°ria", destino:"Aeroporto", valor:60, distancia:5.5}
];

viagens.sort((a,b)=>a.distancia-b.distancia);

/* ===== GANHOS ===== */

function toggleGanhos(){
  const el = document.getElementById("ganhosValor");
  el.classList.toggle("masked");

  if(el.classList.contains("masked")){
    document.getElementById("ganhosHoje").innerText="‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
  }else{
    document.getElementById("ganhosHoje").innerText=
      DataManager.getGanhosHoje().toFixed(2);
  }
}

/* ===== LISTAR VIAGENS ===== */

function renderViagens(){

  const lista = document.getElementById("listaViagens");
  lista.innerHTML="";

  viagens.forEach(v=>{
    lista.innerHTML += `
      <div class="viagem-item" onclick="abrirModal(${v.id})">
        <strong>R$ ${v.valor.toFixed(2)}</strong>
        <div>${v.origem} ‚Üí ${v.destino}</div>
        <div class="distancia">${v.distancia} km de voc√™</div>
      </div>
    `;
  });

}

renderViagens();

/* ===== MODAL ===== */

function abrirModal(id){

  const v = viagens.find(x=>x.id===id);
  const modal = document.getElementById("modal");
  const content = document.getElementById("modalContent");

  const p5 = (v.valor*1.05).toFixed(2);
  const p10 = (v.valor*1.10).toFixed(2);
  const p15 = (v.valor*1.15).toFixed(2);

  content.innerHTML = `
    <h3>${v.origem} ‚Üí ${v.destino}</h3>
    <h2>R$ ${v.valor.toFixed(2)}</h2>

    <div class="percentuais">
      <button onclick="ofertar(${p5})">+5%</button>
      <button onclick="ofertar(${p10})">+10%</button>
      <button onclick="ofertar(${p15})">+15%</button>
    </div>

    <div class="manual">
      <input type="number" id="manualValor" placeholder="Sua oferta">
      <button onclick="ofertaManual(${v.valor})">Ofertar manual</button>
    </div>

    <button onclick="fecharModal()">Fechar</button>
  `;

  modal.style.display="flex";
}

function fecharModal(){
  document.getElementById("modal").style.display="none";
}

function ofertar(valor){
  alert("Oferta enviada: R$ "+valor);
  fecharModal();
}

function ofertaManual(original){

  const val = parseFloat(document.getElementById("manualValor").value);
  if(!val || val<=0){
    alert("Valor inv√°lido");
    return;
  }

  if(val > original*2){
    alert("N√£o pode ultrapassar o dobro do valor original");
    return;
  }

  alert("Oferta manual enviada: R$ "+val.toFixed(2));
  fecharModal();
}

/* ===== BOTTOM BAR ===== */

let alternar = true;

setInterval(()=>{
  document.getElementById("statusMsg").innerText =
    alternar ? "Procurando viagem..." : "Voc√™ est√° online";
  alternar=!alternar;
},3000);

document.getElementById("bottomBar").addEventListener("click",()=>{
  document.getElementById("bottomBar").classList.toggle("collapsed");
});

/* ===== OFFLINE ===== */

function ficarOffline(){
  alert("Voc√™ ficou offline");
}

document.getElementById("creditosTopo").innerText=
  DataManager.getCreditos().toFixed(2);

document.getElementById("ganhosHoje").innerText=
  DataManager.getGanhosHoje().toFixed(2);

</script>

</body>
</html>