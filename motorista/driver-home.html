<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online - RF Motorista</title>

<link rel="stylesheet" href="../core/ui/layout.css">

<script src="../core/config.js"></script>
<script src="../core/datamanager.js"></script>
<script src="../core/services/rideService.js"></script>
<script src="../core/ui/theme.js" defer></script>
<script src="../core/ui/sidebar.js" defer></script>

</head>

<body>

<aside id="sidebar" class="sidebar"></aside>
<div id="overlay" class="overlay"></div>

<header class="rf-top">
  <div class="menu-btn" onclick="toggleSidebar()">☰</div>
  <div>RF Motorista</div>
  <div class="credit-box">
    Créditos: <span id="creditosTopo">0.00</span>
  </div>
</header>

<main class="rf-body">

  <div class="rf-card" style="text-align:center;">
    <h3>Ganhos Hoje</h3>
    <h1>R$ <span id="ganhosHoje">0.00</span></h1>
  </div>

  <button class="fab fab-offline" onclick="ficarOffline()">
    OFFLINE
  </button>

</main>

<script>

document.addEventListener("DOMContentLoaded", ()=>{

if(!DataManager.getCorrida()){
  setTimeout(()=>{
    const corrida = DataManager.criarCorridaSimulada();
    alert("Nova corrida disponível: R$ " + corrida.valor.toFixed(2));
    window.location.href = "corrida-ativa.html";
  }, 3000);
}

  if(!DataManager.isOnline()){
    window.location.href = "offline.html";
    return;
  }

  atualizarTopo();
  atualizarGanhos();

  simularCorrida();
});

function atualizarTopo(){
  document.getElementById("creditosTopo").innerText =
    DataManager.getCreditos().toFixed(2);
}

function atualizarGanhos(){
  document.getElementById("ganhosHoje").innerText =
    DataManager.getGanhosHoje().toFixed(2);
}

function ficarOffline(){
  DataManager.setOnline(false);
  window.location.href = "offline.html";
}

/* SIMULAÇÃO */
function simularCorrida(){

  setTimeout(()=>{

    if(!DataManager.isOnline()) return;

    const corrida = {
      valor: 10.00,
      origem: "Centro",
      destino: "Shopping"
    };

    RideService.aceitarCorrida(corrida);

  }, 5000);

}

</script>

</body>
</html>