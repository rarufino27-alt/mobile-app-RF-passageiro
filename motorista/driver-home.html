<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RF Motorista</title>

<link rel="stylesheet" href="../core/ui/layout.css">

<script src="../core/config.js"></script>
<script src="../core/datamanager.js"></script>
<script src="../core/services/soundService.js"></script>
<script src="../core/ui/theme.js" defer></script>
<script src="../core/ui/sidebar.js" defer></script>

<style>

/* ===== TOGGLE ONLINE ===== */

.online-toggle{
  display:flex;
  background:#1c1c1c;
  border-radius:30px;
  padding:5px;
  gap:5px;
}

.toggle-btn{
  padding:6px 16px;
  border-radius:25px;
  font-size:13px;
  font-weight:700;
  cursor:pointer;
  transition:.3s;
}

.toggle-online.active{
  background:#22c55e;
  color:#fff;
}

.toggle-offline.active{
  background:#ef4444;
  color:#fff;
}

/* ===== RADAR ===== */

.radar-container{
  display:flex;
  justify-content:center;
  align-items:center;
  height:55vh;
  flex-direction:column;
}

.radar{
  width:200px;
  height:200px;
  border-radius:50%;
  border:3px solid rgba(34,197,94,.3);
  position:relative;
  overflow:hidden;
}

.radar::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:50%;
  border:3px solid rgba(34,197,94,.6);
  animation:radarPulse 2s infinite;
}

@keyframes radarPulse{
  0%{transform:scale(.8);opacity:.8}
  100%{transform:scale(1.5);opacity:0}
}

.radar-text{
  margin-top:15px;
  font-weight:600;
  opacity:.8;
}

/* ===== LISTA ===== */

.lista{
  margin-top:20px;
  padding-bottom:120px;
}

.ride-item{
  background:rgba(255,255,255,0.05);
  margin:15px;
  padding:18px;
  border-radius:18px;
  cursor:pointer;
  transition:.3s;
  backdrop-filter:blur(6px);
}

.ride-item:hover{
  transform:scale(1.03);
}

.ride-item h3{
  margin:0;
  color:#22c55e;
}

.dist{
  font-size:13px;
  opacity:.7;
}

/* ===== BOTTOM SHEET ===== */

.overlay-ride{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:flex-end;
  justify-content:center;
  z-index:3000;
}

.sheet{
  background:linear-gradient(180deg,#0f172a,#1e293b);
  width:100%;
  max-width:500px;
  border-top-left-radius:25px;
  border-top-right-radius:25px;
  padding:25px;
  animation:slideUp .4s ease;
}

@keyframes slideUp{
  from{transform:translateY(100%);}
  to{transform:translateY(0);}
}

.timer{
  background:#ef4444;
  padding:6px 14px;
  border-radius:20px;
  font-weight:700;
  animation:pulse 1s infinite;
}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.1)}
  100%{transform:scale(1)}
}

.sheet-price{
  font-size:32px;
  text-align:center;
  color:#22c55e;
  margin:15px 0;
}

.accept-btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:30px;
  background:#22c55e;
  font-weight:800;
  font-size:16px;
  cursor:pointer;
  margin-top:15px;
}

.percent-buttons{
  display:flex;
  gap:8px;
  margin-top:10px;
}

.percent-buttons button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:20px;
  background:#1c1c1c;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

.status-msg{
  text-align:center;
  margin-top:10px;
  font-weight:600;
}

</style>
</head>

<body>

<header class="rf-top">
  <div class="menu-btn" onclick="toggleSidebar()">☰</div>
  <div>RF Driver</div>
  <div class="online-toggle">
    <div class="toggle-btn toggle-online active">ONLINE</div>
    <div class="toggle-btn toggle-offline" onclick="irOffline()">OFFLINE</div>
  </div>
</header>

<div class="rf-body">

<!-- RADAR -->
<div id="radarArea" class="radar-container">
  <div class="radar"></div>
  <div class="radar-text">Buscando solicitações próximas...</div>
</div>

<!-- LISTA -->
<div id="listaArea" class="lista" style="display:none;"></div>

</div>

<!-- SHEET -->
<div id="rideOverlay" class="overlay-ride">
  <div class="sheet" id="rideSheet"></div>
</div>

<script>

let viagens = [
  {id:1, origem:"Centro", destino:"Shopping", valor:40, distancia:1.2},
  {id:2, origem:"Praia", destino:"Hospital", valor:35, distancia:2.8},
  {id:3, origem:"Rodoviária", destino:"Aeroporto", valor:60, distancia:4.5}
];

viagens.sort((a,b)=>a.distancia-b.distancia);

setTimeout(()=>{
  document.getElementById("radarArea").style.display="none";
  renderLista();
},3000);

function renderLista(){

  const area = document.getElementById("listaArea");
  area.style.display="block";
  area.innerHTML="";

  viagens.forEach(v=>{
    area.innerHTML += `
      <div class="ride-item" onclick="abrirSheet(${v.id})">
        <h3>R$ ${v.valor.toFixed(2)}</h3>
        <div>${v.origem} → ${v.destino}</div>
        <div class="dist">${v.distancia} km de você</div>
      </div>
    `;
  });

}

let timerInterval;

function abrirSheet(id){

  const v = viagens.find(x=>x.id===id);

  document.getElementById("rideOverlay").style.display="flex";

  document.getElementById("rideSheet").innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>Nova Solicitação</div>
      <div class="timer" id="timer">15</div>
    </div>

    <div class="sheet-price">R$ ${v.valor.toFixed(2)}</div>

    <div>${v.origem} → ${v.destino}</div>

    <button class="accept-btn" onclick="aceitarDireto(${v.valor})">
      ACEITAR POR R$ ${v.valor.toFixed(2)}
    </button>

    <div class="percent-buttons">
      <button onclick="enviarProposta(${v.valor},1.05)">+5%</button>
      <button onclick="enviarProposta(${v.valor},1.10)">+10%</button>
      <button onclick="enviarProposta(${v.valor},1.15)">+15%</button>
    </div>

    <div class="status-msg" id="statusMsg"></div>
  `;

  SoundService.play("CHAMADA");

  iniciarTimer();

}

function iniciarTimer(){

  let tempo=15;

  timerInterval=setInterval(()=>{
    tempo--;
    document.getElementById("timer").innerText=tempo;

    if(tempo<=0){
      clearInterval(timerInterval);
      fecharSheet();
    }
  },1000);

}

function aceitarDireto(valor){
  clearInterval(timerInterval);
  SoundService.play("ACEITA");
  window.location.href="corrida-ativa.html";
}

function enviarProposta(valor,multi){

  clearInterval(timerInterval);

  const novoValor=(valor*multi).toFixed(2);

  document.getElementById("statusMsg").innerText="Enviando proposta...";

  SoundService.play("MSG_PASSAGEIRO");

  setTimeout(()=>{

    const aceita=Math.random()<0.6;

    if(aceita){
      SoundService.play("ACEITA");
      document.getElementById("statusMsg").innerText="Proposta aceita!";
      setTimeout(()=>{
        window.location.href="corrida-ativa.html";
      },1500);
    }else{
      SoundService.play("CANCELADA");
      document.getElementById("statusMsg").innerText="Proposta recusada.";
      setTimeout(()=>{
        fecharSheet();
      },1500);
    }

  },3000);

}

function fecharSheet(){
  document.getElementById("rideOverlay").style.display="none";
}

function irOffline(){
  DataManager.setOnline(false);
  window.location.href="offline.html";
}

</script>

</body>
</html>